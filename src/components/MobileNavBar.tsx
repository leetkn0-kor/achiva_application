import * as Haptics from 'expo-haptics';
import React, { memo } from 'react';
import { Pressable, StyleSheet, Text, View } from 'react-native';
import Svg, { Path } from 'react-native-svg';

type Tab = { label: string; path: string; };
const TABS: Tab[] = [
  { label: '홈', path: '/[nickname]/home' },
  { label: '목표', path: '/[nickname]/goals' },
  { label: '피드', path: '/' },
  // { label: '응원함', path: '/cheer' },    // Modal
  { label: '응원함', path: '/accounts/notifications' },
  { label: '프로필', path: '/[nickname]' },
];

interface Props {
  currentPath: string;
  onSelect: (path: string) => void;
}

const NativeNavBar: React.FC<Props> = ({ currentPath, onSelect }) => {
  return (
    <View style={styles.wrap}>
      <View style={styles.bar}>
        {TABS.map((t) => {
          const active = currentPath === t.path || currentPath.startsWith(t.path + '/');
          return (
            <Pressable
              key={t.path}
              style={({ pressed }) => [styles.tab, pressed && styles.pressed]}
              android_ripple={{ color: 'rgba(0,0,0,0.06)', borderless: false }}
              onPress={() => {
                Haptics.selectionAsync();
                onSelect(t.path);
              }}
            >
              {active && <View style={styles.indicator} />}

              <View style={styles.iconBox}>
                {renderIcon(t.label, active)}
              </View>

              <Text style={[styles.label, active ? styles.labelActive : styles.labelInactive]} numberOfLines={1}>
                {t.label === '응원함' ? '응원' : t.label /* 웹 라벨과 맞춤(표시는 UI만) */}
              </Text>
            </Pressable>
          );
        })}
      </View>
    </View>
  );
};

export default memo(NativeNavBar);

function HomeIcon({ fill = false }: { fill?: boolean }) {
  return (
    <Svg width={32} height={32} viewBox="0 0 32 32">
      {fill ? (
        <Path d="M28 15V27C28 27.2653 27.8946 27.5196 27.7071 27.7072C27.5196 27.8947 27.2652 28 27 28H20C19.7348 28 19.4804 27.8947 19.2929 27.7072C19.1054 27.5196 19 27.2653 19 27V20.5C19 20.3674 18.9473 20.2403 18.8536 20.1465C18.7598 20.0527 18.6326 20 18.5 20H13.5C13.3674 20 13.2402 20.0527 13.1464 20.1465C13.0527 20.2403 13 20.3674 13 20.5V27C13 27.2653 12.8946 27.5196 12.7071 27.7072C12.5196 27.8947 12.2652 28 12 28H5C4.73478 28 4.48043 27.8947 4.29289 27.7072C4.10536 27.5196 4 27.2653 4 27V15C4.00025 14.4697 4.21112 13.9612 4.58625 13.5863L14.5863 3.5863C14.9613 3.21151 15.4698 3.00098 16 3.00098C16.5302 3.00098 17.0387 3.21151 17.4137 3.5863L27.4137 13.5863C27.7889 13.9612 27.9998 14.4697 28 15Z" fill="#412A2A"/>
      ) : (
        <Path d="M27.4138 13.5848L17.4138 3.58483C17.0387 3.21005 16.5302 2.99951 16 2.99951C15.4698 2.99951 14.9613 3.21005 14.5863 3.58483L4.58626 13.5848C4.39964 13.7701 4.25171 13.9906 4.15107 14.2335C4.05042 14.4764 3.99908 14.7369 4.00001 14.9998V26.9998C4.00001 27.2651 4.10537 27.5194 4.29291 27.7069C4.48044 27.8945 4.7348 27.9998 5.00001 27.9998H13C13.2652 27.9998 13.5196 27.8945 13.7071 27.7069C13.8947 27.5194 14 27.2651 14 26.9998V19.9998H18V26.9998C18 27.2651 18.1054 27.5194 18.2929 27.7069C18.4804 27.8945 18.7348 27.9998 19 27.9998H27C27.2652 27.9998 27.5196 27.8945 27.7071 27.7069C27.8947 27.5194 28 27.2651 28 26.9998V14.9998C28.0009 14.7369 27.9496 14.4764 27.849 14.2335C27.7483 13.9906 27.6004 13.7701 27.4138 13.5848ZM26 25.9998H20V18.9998C20 18.7346 19.8947 18.4803 19.7071 18.2927C19.5196 18.1052 19.2652 17.9998 19 17.9998H13C12.7348 17.9998 12.4804 18.1052 12.2929 18.2927C12.1054 18.4803 12 18.7346 12 18.9998V25.9998H6.00001V14.9998L16 4.99983L26 14.9998V25.9998Z" fill="#412A2A"/>
      )}
    </Svg>
  );
}

function GoalIcon({ fill = false }: { fill?: boolean }) {
  return (
    <Svg width={32} height={32} viewBox="0 0 32 32">
      {fill ? (
        <Path d="M29 7.00003V22C28.9992 22.1424 28.968 22.2829 28.9085 22.4123C28.849 22.5416 28.7626 22.6568 28.655 22.75C26.745 24.4038 24.9188 25 23.1775 25C20.8137 25 18.6062 23.9075 16.5525 22.8938C13.2337 21.25 10.3488 19.8263 7 22.4713V28C7 28.2652 6.89464 28.5196 6.70711 28.7071C6.51957 28.8947 6.26522 29 6 29C5.73478 29 5.48043 28.8947 5.29289 28.7071C5.10536 28.5196 5 28.2652 5 28V7.00003C5.00096 6.85756 5.03235 6.71695 5.09206 6.5876C5.15178 6.45826 5.23844 6.34316 5.34625 6.25003C9.84625 2.35253 13.885 4.34878 17.445 6.11003C20.875 7.80753 23.8487 9.27503 27.345 6.25003C27.4895 6.12476 27.6669 6.04355 27.8562 6.01604C28.0454 5.98853 28.2386 6.01587 28.4128 6.0948C28.587 6.17374 28.7349 6.30098 28.839 6.46142C28.943 6.62186 28.9989 6.80879 29 7.00003Z" fill="#412A2A"/>
      ) : (
        <Path d="M5.345 6.24984C5.23742 6.34309 5.15099 6.45824 5.09149 6.58758C5.032 6.71692 5.0008 6.85748 5 6.99984V27.9998C5 28.2651 5.10536 28.5194 5.29289 28.707C5.48043 28.8945 5.73478 28.9998 6 28.9998C6.26522 28.9998 6.51957 28.8945 6.70711 28.707C6.89464 28.5194 7 28.2651 7 27.9998V22.4711C10.3488 19.8261 13.2337 21.2523 16.5562 22.8973C18.6062 23.9111 20.8137 25.0036 23.1812 25.0036C24.9225 25.0036 26.7488 24.4098 28.6588 22.7536C28.7663 22.6603 28.8528 22.5452 28.9123 22.4159C28.9718 22.2865 29.0029 22.146 29.0037 22.0036V6.99984C29.0033 6.8079 28.9476 6.62015 28.8433 6.45899C28.7391 6.29784 28.5906 6.17009 28.4157 6.09102C28.2408 6.01194 28.0469 5.98486 27.857 6.01303C27.6672 6.04119 27.4894 6.1234 27.345 6.24984C23.845 9.27859 20.88 7.81109 17.4438 6.10984C13.8838 4.34484 9.8475 2.34859 5.345 6.24984ZM27 21.5311C23.6512 24.1761 20.7663 22.7486 17.4438 21.1048C14.3188 19.5611 10.8425 17.8386 7 20.0548V7.47359C10.3488 4.82859 13.2337 6.25484 16.5562 7.89859C19.6812 9.44234 23.1588 11.1648 27 8.94859V21.5311Z" fill="#412A2A"/>
      )}
    </Svg>
  );
}

function FeedIcon({ fill = false }: { fill?: boolean }) {
  return (
    <Svg width={32} height={32} viewBox="0 0 32 32">
      {fill ? (
        <Path d="M27.6 21.2C27.4269 21.0702 27.2164 21 27 21H26V8C26 6.93913 25.5786 5.92172 24.8284 5.17157C24.0783 4.42143 23.0609 4 22 4H5C3.93913 4 2.92172 4.42143 2.17157 5.17157C1.42143 5.92172 1 6.93913 1 8C1 9.70125 2.25625 10.6925 2.4 10.8C2.57262 10.9307 2.78347 11.001 3 11C3.20842 10.9994 3.41144 10.9338 3.58071 10.8122C3.74997 10.6906 3.87702 10.5191 3.94408 10.3218C4.01114 10.1244 4.01487 9.91109 3.95475 9.71153C3.89463 9.51198 3.77366 9.33619 3.60875 9.20875C3.60375 9.2025 3 8.7175 3 8C3 7.46957 3.21071 6.96086 3.58579 6.58579C3.96086 6.21071 4.46957 6 5 6C5.53043 6 6.03914 6.21071 6.41421 6.58579C6.78929 6.96086 7 7.46957 7 8V24C7 25.0609 7.42143 26.0783 8.17157 26.8284C8.92172 27.5786 9.93913 28 11 28H25C26.0609 28 27.0783 27.5786 27.8284 26.8284C28.5786 26.0783 29 25.0609 29 24C29 22.2987 27.75 21.3075 27.6 21.2ZM13 12H21C21.2652 12 21.5196 12.1054 21.7071 12.2929C21.8946 12.4804 22 12.7348 22 13C22 13.2652 21.8946 13.5196 21.7071 13.7071C21.5196 13.8946 21.2652 14 21 14H13C12.7348 14 12.4804 13.8946 12.2929 13.7071C12.1054 13.5196 12 13.2652 12 13C12 12.7348 12.1054 12.4804 12.2929 12.2929C12.4804 12.1054 12.7348 12 13 12ZM12 17C12 16.7348 12.1054 16.4804 12.2929 16.2929C12.4804 16.1054 12.7348 16 13 16H21C21.2652 16 21.5196 16.1054 21.7071 16.2929C21.8946 16.4804 22 16.7348 22 17C22 17.2652 21.8946 17.5196 21.7071 17.7071C21.5196 17.8946 21.2652 18 21 18H13C12.7348 18 12.4804 17.8946 12.2929 17.7071C12.1054 17.5196 12 17.2652 12 17ZM25 26H13.4637C13.8159 25.3924 14.001 24.7023 14 24C14.0002 23.6609 13.9493 23.3238 13.8488 23H26.5987C26.847 23.2753 26.99 23.6295 27.0025 24C27.0025 24.2629 26.9507 24.5231 26.85 24.7659C26.7494 25.0088 26.6018 25.2293 26.4158 25.4151C26.2298 25.6008 26.0091 25.7481 25.7661 25.8485C25.5232 25.9488 25.2629 26.0003 25 26Z" fill="#412A2A"/>
      ) : (
        <Path d="M12 13C12 12.7348 12.1054 12.4804 12.2929 12.2929C12.4804 12.1054 12.7348 12 13 12H21C21.2652 12 21.5196 12.1054 21.7071 12.2929C21.8946 12.4804 22 12.7348 22 13C22 13.2652 21.8946 13.5196 21.7071 13.7071C21.5196 13.8946 21.2652 14 21 14H13C12.7348 14 12.4804 13.8946 12.2929 13.7071C12.1054 13.5196 12 13.2652 12 13ZM13 18H21C21.2652 18 21.5196 17.8946 21.7071 17.7071C21.8946 17.5196 22 17.2652 22 17C22 16.7348 21.8946 16.4804 21.7071 16.2929C21.5196 16.1054 21.2652 16 21 16H13C12.7348 16 12.4804 16.1054 12.2929 16.2929C12.1054 16.4803 12 16.7348 12 17C12 17.2652 12.1054 17.5196 12.2929 17.7071C12.4804 17.8946 12.7348 18 13 18ZM29 24C29 25.0609 28.5786 26.0783 27.8284 26.8284C27.0783 27.5786 26.0609 28 25 28H11C9.93913 28 8.92172 27.5786 8.17157 26.8284C7.42143 26.0783 7 25.0609 7 24V8C7 7.46957 6.78929 6.96086 6.41421 6.58579C6.03914 6.21071 5.53043 6 5 6C4.46957 6 3.96086 6.21071 3.58579 6.58579C3.21071 6.96086 3 7.46957 3 8C3 8.7175 3.60375 9.2025 3.61 9.2075C3.7755 9.33486 3.89698 9.51084 3.95738 9.71075C4.01779 9.91066 4.01409 10.1245 3.94681 10.3222C3.87953 10.5199 3.75205 10.6915 3.58224 10.8131C3.41244 10.9347 3.20883 11 3 11C2.78375 11.0004 2.57337 10.9297 2.40125 10.7987C2.25625 10.6925 1 9.70125 1 8C1 6.93913 1.42143 5.92172 2.17157 5.17157C2.92172 4.42143 3.93913 4 5 4H22C23.0609 4 24.0783 4.42143 24.8284 5.17157C25.5786 5.92172 26 6.93913 26 8V21H27C27.2164 21 27.4269 21.0702 27.6 21.2C27.75 21.3075 29 22.2987 29 24ZM12.0325 21.685C12.1008 21.4833 12.2312 21.3084 12.405 21.1854C12.5788 21.0623 12.7871 20.9974 13 21H24V8C24 7.46957 23.7893 6.96086 23.4142 6.58579C23.0391 6.21071 22.5304 6 22 6H8.46125C8.81492 6.60713 9.00086 7.29737 9 8V24C9 24.5304 9.21071 25.0391 9.58579 25.4142C9.96086 25.7893 10.4696 26 11 26C11.5304 26 12.0391 25.7893 12.4142 25.4142C12.7893 25.0391 13 24.5304 13 24C13 23.2825 12.3963 22.7975 12.39 22.7925C12.2196 22.6706 12.0928 22.4972 12.0285 22.2977C11.9641 22.0983 11.9655 21.8835 12.0325 21.685ZM27 24C26.9875 23.6295 26.8445 23.2753 26.5963 23H14.8462C14.9468 23.3238 14.9978 23.6609 14.9975 24C14.9985 24.7023 14.8134 25.3924 14.4613 26H25C25.5304 26 26.0391 25.7893 26.4142 25.4142C26.7893 25.0391 27 24.5304 27 24Z" fill="#412A2A"/>
      )}
    </Svg>
  );
}

function HeartIcon({ fill = false }: { fill?: boolean }) {
  return (
    <Svg width={32} height={32} viewBox="0 0 32 32">
      {fill ? (
        <Path d="M30.0003 12.2502C30.0024 13.2025 29.8157 14.1458 29.451 15.0255C29.0862 15.9052 28.5507 16.7038 27.8753 17.3752L16.7128 28.7027C16.6198 28.7972 16.5089 28.8722 16.3865 28.9234C16.2642 28.9747 16.1329 29.001 16.0003 29.001C15.8677 29.001 15.7364 28.9747 15.6141 28.9234C15.4918 28.8722 15.3809 28.7972 15.2878 28.7027L4.12531 17.3752C2.76442 16.016 1.99922 14.1718 1.99805 12.2484C1.99688 10.325 2.75983 8.47986 4.11906 7.11896C5.4783 5.75807 7.32247 4.99287 9.24589 4.9917C11.1693 4.99053 13.0144 5.75348 14.3753 7.11271L16.0003 8.63146L17.6366 7.10771C18.6521 6.0972 19.9443 5.41022 21.35 5.1335C22.7557 4.85679 24.2118 5.00274 25.5346 5.55293C26.8574 6.10313 27.9875 7.0329 28.7823 8.22486C29.5771 9.41683 30.001 10.8176 30.0003 12.2502Z" fill="#343330"/>
      ) : (
        <Path d="M27.8748 7.12502C26.5162 5.76984 24.6763 5.00775 22.7574 5.00541C20.8385 5.00307 18.9967 5.76066 17.6348 7.11252L15.9998 8.63127L14.3636 7.10752C13.002 5.74978 11.1569 4.98852 9.23404 4.99122C7.3112 4.99391 5.46819 5.76034 4.11045 7.1219C2.75271 8.48345 1.99145 10.3286 1.99415 12.2514C1.99684 14.1743 2.76327 16.0173 4.12483 17.375L15.2936 28.7075C15.3866 28.802 15.4975 28.877 15.6199 28.9283C15.7422 28.9795 15.8735 29.0058 16.0061 29.0058C16.1387 29.0058 16.27 28.9795 16.3923 28.9283C16.5146 28.877 16.6255 28.802 16.7186 28.7075L27.8748 17.375C29.2335 16.0155 29.9968 14.1721 29.9968 12.25C29.9968 10.3279 29.2335 8.48454 27.8748 7.12502ZM26.4561 15.97L15.9998 26.575L5.53733 15.96C4.55271 14.9754 3.99956 13.64 3.99956 12.2475C3.99956 10.8551 4.55271 9.51964 5.53733 8.53502C6.52194 7.55041 7.85737 6.99725 9.24983 6.99725C10.6423 6.99725 11.9777 7.55041 12.9623 8.53502L12.9873 8.56002L15.3186 10.7288C15.5036 10.901 15.747 10.9967 15.9998 10.9967C16.2526 10.9967 16.496 10.901 16.6811 10.7288L19.0123 8.56002L19.0373 8.53502C20.0226 7.55107 21.3584 6.99882 22.7509 6.99975C24.1433 7.00069 25.4784 7.55474 26.4623 8.54002C27.4463 9.5253 27.9985 10.8611 27.9976 12.2536C27.9967 13.646 27.4426 14.9811 26.4573 15.965L26.4561 15.97Z" fill="#343330"/>
      )}
    </Svg>
  );
}

function MyPageIcon({ fill = false }: { fill?: boolean }) {
  return (
    <Svg width={32} height={32} viewBox="0 0 32 32">
      {fill ? (
        <Path d="M28.8652 27.5C28.7774 27.652 28.6512 27.7783 28.4991 27.8661C28.347 27.9538 28.1746 28 27.999 28H3.99897C3.82353 27.9998 3.65121 27.9535 3.49933 27.8656C3.34746 27.7778 3.22137 27.6515 3.13372 27.4995C3.04607 27.3475 2.99995 27.1752 3 26.9997C3.00005 26.8243 3.04625 26.6519 3.13397 26.5C5.03772 23.2087 7.97147 20.8487 11.3952 19.73C9.70168 18.7218 8.38591 17.1856 7.64996 15.3572C6.91401 13.5289 6.79858 11.5095 7.3214 9.60918C7.84422 7.70887 8.97638 6.03272 10.544 4.83814C12.1116 3.64355 14.0281 2.99658 15.999 2.99658C17.9699 2.99658 19.8863 3.64355 21.4539 4.83814C23.0216 6.03272 24.1537 7.70887 24.6765 9.60918C25.1994 11.5095 25.0839 13.5289 24.348 15.3572C23.612 17.1856 22.2963 18.7218 20.6027 19.73C24.0265 20.8487 26.9602 23.2087 28.864 26.5C28.9519 26.6519 28.9984 26.8243 28.9986 26.9998C28.9988 27.1754 28.9528 27.3479 28.8652 27.5Z" fill="#412A2A"/>
      ) : (
        <Path d="M28.8658 26.5C26.9621 23.2087 24.0283 20.8487 20.6046 19.73C22.2981 18.7218 23.6139 17.1856 24.3498 15.3572C25.0858 13.5289 25.2012 11.5095 24.6784 9.60918C24.1556 7.70887 23.0234 6.03272 21.4558 4.83814C19.8882 3.64355 17.9717 2.99658 16.0008 2.99658C14.0299 2.99658 12.1135 3.64355 10.5459 4.83814C8.97823 6.03272 7.84607 7.70887 7.32325 9.60918C6.80043 11.5095 6.91586 13.5289 7.65181 15.3572C8.38776 17.1856 9.70354 18.7218 11.3971 19.73C7.97333 20.8475 5.03958 23.2075 3.13583 26.5C3.06601 26.6138 3.01971 26.7405 2.99964 26.8725C2.97957 27.0045 2.98615 27.1392 3.01898 27.2687C3.05182 27.3981 3.11024 27.5197 3.19082 27.6262C3.27139 27.7326 3.37247 27.8219 3.48811 27.8887C3.60374 27.9555 3.73158 27.9985 3.86409 28.015C3.99659 28.0316 4.13107 28.0215 4.2596 27.9853C4.38813 27.949 4.5081 27.8874 4.61244 27.8041C4.71677 27.7207 4.80335 27.6173 4.86708 27.5C7.22208 23.43 11.3846 21 16.0008 21C20.6171 21 24.7796 23.43 27.1346 27.5C27.1983 27.6173 27.2849 27.7207 27.3892 27.8041C27.4936 27.8874 27.6135 27.949 27.742 27.9853C27.8706 28.0215 28.0051 28.0316 28.1376 28.015C28.2701 27.9985 28.3979 27.9555 28.5135 27.8887C28.6292 27.8219 28.7303 27.7326 28.8108 27.6262C28.8914 27.5197 28.9498 27.3981 28.9827 27.2687C29.0155 27.1392 29.0221 27.0045 29.002 26.8725C28.9819 26.7405 28.9356 26.6138 28.8658 26.5ZM9.00083 12C9.00083 10.6155 9.41137 9.26214 10.1805 8.11099C10.9497 6.95985 12.043 6.06264 13.322 5.53283C14.6011 5.00301 16.0086 4.86439 17.3665 5.13449C18.7243 5.40458 19.9716 6.07127 20.9506 7.05023C21.9295 8.0292 22.5962 9.27648 22.8663 10.6344C23.1364 11.9922 22.9978 13.3997 22.468 14.6788C21.9382 15.9578 21.041 17.0511 19.8898 17.8203C18.7387 18.5894 17.3853 19 16.0008 19C14.1449 18.998 12.3656 18.2599 11.0533 16.9475C9.74095 15.6352 9.00281 13.8559 9.00083 12Z" fill="#412A2A"/>
      )}
    </Svg>
  );
}

/* ---------- Styles ---------- */
const TOP_PAD = 19;   // bar 상단 패딩
const BORDER_W = 1;   // bar borderTopWidth
const INDICATOR_PULL_UP = TOP_PAD + BORDER_W;

const COLORS = {
  bg: '#FFFFFF',
  text: '#343330',
  textInactive: '#343330',
  textActive: '#343330',
  indicator: '#343330',
  border: '#EAEAEA',
  shadow: '#000',
};

const styles = StyleSheet.create({
  wrap: {
    position: 'absolute',
    left: 0,
    right: 0,
    bottom: 0,
  },
  bar: {
    backgroundColor: COLORS.bg,
    borderTopWidth: BORDER_W,
    borderTopColor: COLORS.border,
    paddingTop: TOP_PAD,
    paddingBottom: 19,
    paddingHorizontal: 7,
    flexDirection: 'row',
    justifyContent: 'space-around',
    alignItems: 'flex-start',
    overflow: 'visible',
    elevation: 10,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.08,
    shadowRadius: 15,
    shadowOffset: { width: 0, height: -5 },
  },
  tab: {
    width: 44,
    alignItems: 'center',
    justifyContent: 'flex-start',
    position: 'relative',
  },
  iconBox: {
    width: 32,
    height: 32,
    alignItems: 'center',
    justifyContent: 'center',
  },
  indicator: {
    position: 'absolute',
    top: -INDICATOR_PULL_UP,
    left: 0,
    right: 0,
    height: 3,
    borderBottomLeftRadius: 2,
    borderBottomRightRadius: 2,
    backgroundColor: COLORS.indicator,
  },
  label: {
    fontSize: 15,
    lineHeight: 18,
    marginTop: 4,
  },
  labelInactive: {
    fontWeight: '300',
    color: COLORS.textInactive,
  },
  labelActive: {
    fontWeight: '600',
    color: COLORS.textActive,
  },
  pressed: { opacity: 0.85 },
});

/* ---------- Icon Resolver ---------- */

function renderIcon(label: string, active: boolean) {
  switch (label) {
    case '홈': return <HomeIcon fill={active} />;
    case '목표': return <GoalIcon fill={active} />;
    case '피드': return <FeedIcon fill={active} />;
    case '응원함': return <HeartIcon fill={active} />; // 웹: notifications 하트
    case '프로필': return <MyPageIcon fill={active} />;
    default: return <HomeIcon fill={active} />;
  }
}